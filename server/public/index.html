<!doctype html>
<html>
  <head>
    <title>Scores</title>
  </head>
  <body>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/core-js/2.1.4/core.min.js"></script>
    <script src="http://unpkg.com/@feathersjs/client@^3.0.0/dist/feathers.js"></script>
    <script src="http://unpkg.com/socket.io-client@1.7.3/dist/socket.io.js"></script>
    <script>
      // Socket.io is exposed as the `io` global.
      var socket = io('http://localhost:3030');
      // @feathersjs/client is exposed as the `feathers` global.
      var app = feathers();

      // Set up Socket.io client with the socket
      app.configure(feathers.socketio(socket));

      function refresh() {
        app.service('scores').find({}).then(display);
        // fetch('http://localhost:3030/scores')
        //   .then(res => res.json())
        //   .then(display);
      }

      function display(data) {
        const scoresDiv = window.scores;
        scoresDiv.innerHTML = data
          .slice(0, 10)
          .map((score, i) => `${i + 1}. [id: ${score.playerId}] ${score.score}`).join('<br>');
        console.log('scores', data);
      }

      // Receive real-time events through Socket.io
      app.service('scores')
        .on('created', () => refresh())
        .on('updated', () => refresh())
        .on('removed', () => refresh());

      // Initial refresh
      refresh();

      // Update data
      app.service('scores').update(6, {
        playerId: 4,
        score: 200
      });

      app.service('scores').update(6, {
        playerId: 4,
        score: 400
      });

      // feathers.errors is an object with all of the custom error types.
    </script>
    <h2>Top 10</h2>
    <div id="scores"></div>
  </body>
</html>
